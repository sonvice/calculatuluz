---
import { navigation as navDefault } from "../constant";
import Logo from "../assets/logo-calcula-tu-luz.svg";
import LogoMobile from "../assets/logo-mobile.svg";

const currentPath = Astro.url.pathname;

const navigation = navDefault.filter((item) => {
  if (item.onlyTips && currentPath === "/") {
    return false;
  }
  return true;
});
---

<header class="header">
  <div class="header__bar">
    <div class="container">
      <div class="header__content d-flex">
        <!-- Logo -->
        <div class="logo-wrapper">
          <a aria-label="Logo de calculatuluz.es" href="/">
            <span class="logo-desktop">
              <Logo width={160} />
            </span>
            <span class="logo-mobile">
              <LogoMobile width={45} />
            </span>
          </a>
        </div>

        <!-- Navigation (Desktop y Mobile) -->
        <nav aria-label="Main navigation" class="nav">
          <ul class="nav__list" role="menubar">
            {
              navigation.map((item) => {
                const isActive =
                  item.url === "/"
                    ? currentPath === "/"
                    : currentPath.startsWith(item.url);
                return (
                  <li role="none">
                    <a
                      href={item.url}
                      role="menuitem"
                      aria-current={isActive ? "page" : undefined}
                      class={`nav__link text-neutral-50 ${
                        isActive ? "nav__link--active fw-500" : ""
                      }`}
                    >
                      {item.title}
                    </a>
                  </li>
                );
              })
            }
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

<style>
  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    background-color: var(--primary-900);
  }

  .header__bar {
    padding-block: var(--space-s);
  }

  .header__content {
--horizontal-alignment:space-between;
flex-wrap: nowrap;
  }

  /* Logo */
  .logo-wrapper {
    flex-shrink: 0;
  }

  .logo-desktop {
    display: inline-block;
  }
  
  .logo-mobile {
    display: none;
  }

  .logo-wrapper a {
    display: inline-flex;
    align-items: center;
  }

  .logo-wrapper svg {
    height: auto;
  }

  /* Navigation */
  .nav {
    overflow: hidden;
  }

  .nav__list {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: var(--space-xs);
    overflow-x: auto;
    overflow-y: hidden;
    
    /* Ocultar scrollbar pero mantener funcionalidad */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
  }

  .nav__list::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
  }

  /* Smooth scroll en navegación */
  .nav__list {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
  }

  .nav__list li {
    flex-shrink: 0;
  }

  .nav__link {
    display: block;
    padding: var(--space-2xs) var(--space-s);
    white-space: nowrap;
    transition: all 0.2s ease;
    font-size: var(--size-0);
  }

  .nav__link:hover,
  .nav__link:focus {
    background-color: var(--primary-700);
  }


  /* Mobile Adjustments */
  @media (max-width: 63.99875em) {
    .header {
        border-bottom: 1px solid var(--primary-800);
    }
    .header__bar {
      padding-block: var(--space-xs);
    }

    .header__content {
      gap: var(--space-m);
    }

    /* Mostrar logo mobile */
    .logo-desktop {
      display: none;
    }
    
    .logo-mobile {
      display: inline-block;
    }

    /* Ajustar tamaño de links en mobile */
    .nav__link {
      padding: var(--space-2xs) var(--space-xs);
      font-size: var(--size--1);
    }

    /* Agregar fade effect en los bordes */
    .nav {
      position: relative;
    }

    .nav::after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 30px;
      background: linear-gradient(to right, transparent, var(--primary-900));
      pointer-events: none;
    }
  }

  /* Animación sutil al hacer scroll */
  @media (prefers-reduced-motion: no-preference) {
    .nav__list {
      scroll-snap-type: x proximity;
    }

    .nav__list li {
      scroll-snap-align: start;
    }
  }
</style>

<script>
  // Agregar indicador visual de scroll disponible
  const navList = document.querySelector('.nav__list') as HTMLElement;
  
  if (navList) {
    function updateScrollIndicator() {
      const isScrollable = navList.scrollWidth > navList.clientWidth;
      const isAtEnd = navList.scrollLeft >= (navList.scrollWidth - navList.clientWidth - 10);
      
      if (isScrollable && !isAtEnd) {
        navList.classList.add('has-more-content');
      } else {
        navList.classList.remove('has-more-content');
      }
    }

    navList.addEventListener('scroll', updateScrollIndicator);
    window.addEventListener('resize', updateScrollIndicator);
    updateScrollIndicator();
  }
</script>